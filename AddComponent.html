<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="css/style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Finanace Calculator</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-database.js"></script>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCucS1QK2hwle0_EFSERmvUHBM2aaQ3rIc",
            authDomain: "finance-calculator-d5c33.firebaseapp.com",
            databaseURL: "https://finance-calculator-d5c33.firebaseio.com",
            projectId: "finance-calculator-d5c33",
            storageBucket: "finance-calculator-d5c33.appspot.com",
            messagingSenderId: "463292274886",
            appId: "1:463292274886:web:e2d950145f41c813fc1fc7"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>


</head>

<body>
    <div class="row">
        <div class="container">
            <h2 style="align-items: center;">Add Components</h2>

            <div class="alert alert-success success-message" style="display:none;">Form submitted successfully.</div>

            <form id="dashBoardForm" onsubmit="addComponent()">
                <div class="row" style="margin-top: 30px">
                    <div class="col-md-4">
                        <label for="cmpId">Component Id*</label>
                        <input type="text" class="form-control fullname" id="cmpId" placeholder="Enter Component Id"
                            required>
                    </div>

                    <div class="col-md-4">
                        <label for="cmpPos">Component Position*</label>
                        <input type="text" class="form-control fullname" id="cmpPos"
                            placeholder="Enter Component Position" required>
                    </div>

                    <div class="col-md-4">
                        <label for="cmpType">Component Type*</label>

                        <select id="cmpType" class="form-control fullname" onchange="hideShowComponent(this)">
                            <option value=1>Select Component Type</option>
                            <option value=1>Carousel Component</option>
                            <option value=2>WebView Component</option>
                            <option value=3>Horizontal View Pager</option>
                            <option value=4>Header Component</option>
                            <option value=5>Calculator List</option>
                            <option value=6>Space Component</option>
                            <option value=7>AdView Component</option>

                        </select>

                    </div>
                </div>



                <div class="row" style="margin-top: 30px" id="cmpList">
                    <!-- <label for="dynamicSelect" id="selectedComp">Select Component Data*</label> -->

                </div>



                <button class="btn btn-primary" style="display: block; margin: 0 auto; margin-top: 20px">Submit</button>

            </form>
        </div>
    </div>
</body>

</html>


<script>
    var database = firebase.database();
    var compRef = firebase.database().ref('components/');

    function addComponent() {
        console.log("Submit clicked");
        var e = document.getElementById("cmpType");
        var value = e.options[e.selectedIndex].value;
        switch (value) {
            case "1":
                addCarousalComponent();
                break;
            case "5":
                addCalculatorComponent();
                break;
        }

    }


</script>

<!-- show defferent layout on spinner select -->
<script>
    function hideShowComponent(select) {
        switch (select.value) {
            case "1":
                console.log(select.value);
                getCarouselList();
                break;
            case "5":
                console.log(select.value);
                getCalculatorList();
                break;
        }
    }

</script>

<!-- carousal script -->
<script>
    var database = firebase.database();
    var compRef = firebase.database().ref('carousel');

    var selectedList = [];

    function getCarouselList() {

        const myNode = document.getElementById("cmpList");
        myNode.innerHTML = '';
        selectedList = [];
        var tbl = document.createElement("table");
        tbl.style.width = "100%";
        var tr = tbl.insertRow();

        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Carousel Id "));
        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Redirect URL "));
        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Web Url"));
        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Select"));

        compRef.on('value', (snapshot) => {

            snapshot.forEach((stateSnapshot) => {
                //console.log(stateSnapshot.key); // 'pending', etc
                var tr = tbl.insertRow();

                stateSnapshot.forEach((jobSnapshot) => {

                    if (jobSnapshot.key != "firebaseId") {
                        var td = tr.insertCell();
                        td.appendChild(document.createTextNode(jobSnapshot.val()));
                    }
                    //console.log(jobSnapshot.key + " : " + jobSnapshot.val());
                });
                console.log(stateSnapshot.key + " : " + stateSnapshot.child("cmpId").val());
                var td = tr.insertCell();
                var chk = document.createElement('input');
                chk.setAttribute('type', 'checkbox');
                chk.setAttribute('value', 'yes');
                chk.setAttribute('id', 'chk');
                chk.addEventListener('change', function () {
                    if (this.checked) {
                        addCarousel(stateSnapshot);
                        // selectedList.push(stateSnapshot.child("cmpId").val());
                        // console.log(stateSnapshot.child("cmpId").val() + " : " + "Checked");
                        // console.log(selectedList);
                        // document.getElementById('selectedComp').label = selectedList
                    } else {
                        removeCarousel(stateSnapshot);
                        // const index = selectedList.indexOf(stateSnapshot.child("cmpId").val());
                        // if (index > -1) {
                        //     selectedList.splice(index, 1);
                        // }
                        // document.getElementById('selectedComp').setAttribute('label', selectedList)
                        // console.log(stateSnapshot.child("cmpId").val() + " : " + " Un - Checked");
                        // console.log(selectedList);
                    }
                });
                td.appendChild(chk);
            });
        });
        console.log(selectedList);
        $('#cmpList').append(tbl);

    }

    function addCarousel(stateSnapshot) {
        var obj = {
            "redUrl": stateSnapshot.child("redUrl").val(),
            "webUrl": stateSnapshot.child("webUrl").val()
        };
        selectedList.push(obj);
        console.log(stateSnapshot.child("cmpId").val() + " : " + "Checked");
        console.log(selectedList);

    }

    function removeCarousel(stateSnapshot) {
        var filtered = selectedList.filter(function (obj) {
            return ((obj.redUrl != stateSnapshot.child("redUrl").val()) &&
                (obj.webUrl != stateSnapshot.child("webUrl").val()));
        });
        // const index = selectedList.indexOf(stateSnapshot.child("cmpId").val());
        // if (index > -1) {
        //     selectedList.splice(index, 1);
        // }
        selectedList = filtered;
        console.log(stateSnapshot.child("cmpId").val() + " : " + " Un - Checked");
        console.log(selectedList);
    }

    function addCarousalComponent() {
        var compRef = firebase.database().ref('components/');
        console.log("Submit clicked");
        var id = compRef.push();
        console.log("Firebase Key  :" + id);
        console.log("Selected component  :" + JSON.stringify(selectedList));
        id.set({
            cmpId: $('#cmpId').val(),
            cmpPos: parseInt($('#cmpPos').val()),
            cmpType: parseInt($('#cmpType :selected').val()),
            cmpData: JSON.stringify(selectedList),
            firebaseId: "" + id.getKey()
        });
        console.log("Firebase data pushed successfully");
    }

</script>


<!-- Calculator List script -->
<script>
    var database = firebase.database();
    var calRef = firebase.database().ref('calculator');

    var selectedCal = [];

    function getCalculatorList() {

        const myNode = document.getElementById("cmpList");
        myNode.innerHTML = '';
        selectedCal = [];
        var tbl = document.createElement("table");
        tbl.style.width = "100%";
        var tr = tbl.insertRow();

        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Calculator Id "));
        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Calculator Name "));
        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Redirect Url"));
        var th = tr.insertCell();
        th.appendChild(document.createTextNode("Select"));

        calRef.on('value', (snapshot) => {

            snapshot.forEach((stateSnapshot) => {
                //console.log(stateSnapshot.key); // 'pending', etc
                var tr = tbl.insertRow();

                stateSnapshot.forEach((jobSnapshot) => {

                    if ((jobSnapshot.key != "firebaseId") && (jobSnapshot.key != "iconUrl")
                        && (jobSnapshot.key != "input") && (jobSnapshot.key != "output")
                    ) {
                        var td = tr.insertCell();
                        td.appendChild(document.createTextNode(jobSnapshot.val()));
                    }
                    //console.log(jobSnapshot.key + " : " + jobSnapshot.val());
                });
                console.log(stateSnapshot.key + " : " + stateSnapshot.child("firebaseId").val());
                var td = tr.insertCell();
                var chk = document.createElement('input');
                chk.setAttribute('type', 'checkbox');
                chk.setAttribute('value', 'yes');
                chk.setAttribute('id', 'chk');
                chk.addEventListener('change', function () {
                    if (this.checked) {
                        addCalCulator(stateSnapshot);
                    } else {
                        removeCalculator(stateSnapshot);
                    }
                });
                td.appendChild(chk);
            });
        });
        console.log(selectedList);
        $('#cmpList').append(tbl);

    }

    function addCalCulator(stateSnapshot) {
        selectedCal.push(stateSnapshot.val());
        console.log(stateSnapshot.child("firebaseId").val() + " : " + "Checked");
        console.log(selectedCal);

    }

    function removeCalculator(stateSnapshot) {
        var filtered = selectedCal.filter(function (obj) {
            return ((obj.firebaseId != stateSnapshot.child("firebaseId").val()));
        });
        selectedCal = filtered;
        console.log(stateSnapshot.child("firebaseId").val() + " : " + " Un - Checked");
        console.log(selectedCal);
    }

    function addCalculatorComponent() {
        var compRef = firebase.database().ref('components/');
        console.log("Submit clicked");
        var id = compRef.push();
        console.log("Firebase Key  :" + id);
        console.log("Selected component  :" + JSON.stringify(selectedCal));
        id.set({
            cmpId: $('#cmpId').val(),
            cmpPos: parseInt($('#cmpPos').val()),
            cmpType: parseInt($('#cmpType :selected').val()),
            cmpData: JSON.stringify(selectedCal),
            firebaseId: "" + id.getKey()
        });
        console.log("Firebase data pushed successfully");
    }

</script>



<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>